<section class="proj-dashboard">
    <div class="page-header">
        <div class="container">
            <h3 data-wow-delay="0.5s" data-wow-duration="1s" class="wow fadeInUp" style="visibility: hidden; animation-duration: 2s; animation-delay: 0.5s; animation-name: fadeInUp;">لوحة التحكم</h3>
            <h5 *ngIf="userType == 0">
                مدير المشروع
            </h5>
            <h5 *ngIf="userType == 2">
              المقاول
            </h5>
        </div>
    </div>
    <div class="page-content">
        <div class="container">
            <div class="content">
                <div class="tabs-section">
                    <div class="row">
                        <div class="col-lg-3 my-3">
                            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">مراحل المشروع</button>
                                <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false">ملاحظات</button>
                            </div>
                        </div>
                        <div class="col-lg-9 my-3"  *ngIf="isLoaded">
                            <div class="tab-content" id="v-pills-tabContent">
                              <!--مراحل المشروع-->
                                <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                                    <div class="project-stages-tab">
                                        <header>
                                            <h4>{{Project.name}}</h4>
                                            <button  (click)="back()">
                                                <span class="mx-2">عودة</span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                                                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                                                </svg>
                                            </button>
                                        </header>
                                        <article>
                                            <div class="details">
                                                <div class="row justify-content-between align-items-center">
                                                  <div class="col-lg-8 my-3">
                                                      <div class="txt-sec">
                                                          <p>
                                                            <span style="color:#a09f9f">وصف المشروع : </span>
                                                              {{Project.description}}                                                         </p>
                                                          <div class="txt">
                                                              <p>
                                                                  الموقع
                                                                  <span class="mx-1">
                                                                      {{getRegionName(Project.regionId)}}
                                                                  </span>
                                                              </p>
                                                              <p>
                                                                اسم العميل
                                                                <span class="mx-1">
                                                                    {{Project.userName}}
                                                                </span>
                                                            </p>
                                                              <p>
                                                                  نوع المشروع
                                                                  <span class="mx-1">
                                                                      {{getProjectTypeName(Project.projectTypeId)}}

                                                                  </span>
                                                              </p>
                                                              <p>
                                                                  بدأ في
                                                                  <span class="mx-1">
                                                                      {{Project.date}}
                                                                  </span>
                                                              </p>
                                                          </div>
                                                      </div>
                                                  </div>
                                                  <div class="col-lg-4 my-3">
                                                      <div class="more-info">
                                                          <div class="percentag">
                                                              <h6>نسبة التنفيذ</h6>
                                                              <div class="img">
                                                                  <img class="w-100" src="/assets/icons/percentage.png" alt="" srcset="">
                                                                  <span>{{Project.percent}} %</span>
                                                              </div>
                                                          </div>
                                                      </div>
                                                  </div>
                                                </div>
                                                <div class="row">
                                                  <div class="col-lg-8 my-3">
                                                    <h4>مرفقات المشروع</h4>
                                                    <div class=" upload-files">
                                                      <p *ngIf="Project.projectDocuments.length === 0">لا توجد مرفقات للمشروع</p>

                                                      <div class="img-ulpoad">
                                                        <ng-container>
                                                          <lightgallery [settings]="settings" [onInit]="onInit">
                                                            <a *ngFor="let item of Project.projectDocuments" [attr.data-lg-size]="100" className="gallery-item"
                                                              [attr.href]="imgUrl+item.url" [attr.title]="fileType(item.name)==='pdf'?'قم بتحميل ملف من زر التحميل بالاعلي':''">
                                                              <img className="img-responsive " class="img-thumbnails" [src]="imgUrl+item.url" *ngIf="fileType(item.name) === 'jpg'||'jpeg'||'png'" />
                                                              <img className="img-responsive " class="img-thumbnails" src="/assets/icons/pdf.jpg" *ngIf="fileType(item.name) === 'pdf'" />
                                                            </a>
                                                          </lightgallery>
                                                        </ng-container>
                                                      </div>
                                                    </div>
                                                  </div>
                                                  <div class="col-lg-4 my-3">
                                                    <!-- <button type="button" *ngIf="userType == 0 && AllphasesDone.length !== 0" class="btn btn-primary mx-2" data-bs-toggle="modal" data-bs-target="#addInvoiceModal">
                                                      إضافة فاتورة
                                                  </button> -->
                                                  <button nz-button *ngIf="userType == 0 && AllphasesDone.length !== 0" [nzType]="'primary'" (click)="showModal2()"><span>إضافة فاتورة</span></button>

                                                  </div>
                                                </div>
                                            </div>
                                            <ng-container *ngFor="let service of Project.projectServices;let j = index">
                                              <div class="digging-foundations" *ngFor="let phase of service.projectPhases;let i = index"
                                              [ngClass]="phase?.isDone?'':'gray-border'" >
                                                <div class="title">
                                                    <h4>
                                                        <span class="mx-2"> خدمة : {{service.service?.name || service.name}} / مرحلة : {{phase?.title}}</span>
                                                    </h4>
                                                </div>
                                                <div class="more-info">
                                                  <div class="row">
                                                    <div class="col-lg col-md-6 mb-3">
                                                      <div class="txt">
                                                          <p>
                                                              المقاول
                                                              <span class="mx-1">
                                                                  {{phase?.userName}}
                                                              </span>
                                                          </p>
                                                      </div>
                                                  </div>
                                                    <div class="col-lg col-md-6 mb-3">
                                                      <div class="txt">
                                                          <p>
                                                              تاريخ
                                                              <span class="mx-1">
                                                                  {{phase?.dateStart | date:'dd-MM-YYYY'}}
                                                              </span>
                                                          </p>
                                                      </div>
                                                  </div>
                                                  <div class="col-lg col-md-6 mb-3">
                                                    <div class="txt">
                                                        <p>
                                                            وزن المرحلة
                                                            <span class="mx-1">
                                                                {{phase?.doneWight }}%
                                                            </span>
                                                        </p>
                                                    </div>
                                                </div>
                                                  </div>
                                                    <div class="row">
                                                        <div class="col-lg col-md-6 mb-3">
                                                            <div class="txt">
                                                                <p>
                                                                    الحالة
                                                                    <span class="mx-1" *ngIf="userType == 0 || (userType == 2 && !phase?.isCurrant)">
                                                                        {{phase?.isDone? 'تمت':'لم تتم'}}
                                                                    </span>
                                                                    <ng-container *ngIf="userType == 2 && phase?.isCurrant">
                                                                      <select id="inputState" class="form-select mx-1" (change)="changeIsDone($any($event).target,phase.id)">
                                                                        <option value="0" selected>أختر الحالة </option>
                                                                        <option value="true" >تمت</option>
                                                                        <option value="false">لم تتم</option>
                                                                    </select>
                                                                    </ng-container>
                                                                </p>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg col-md-6 mb-3">
                                                            <div class="txt">
                                                                <p>
                                                                    المراجعة
                                                                      <span *ngIf="!phase?.isReview"> لم تتم</span>
                                                                      <nz-rate [(ngModel)]="phase.review" nzDisabled *ngIf="phase?.isReview"></nz-rate>
                                                                </p>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-12 mb-3">
                                                          <div class="txt">
                                                            <h5 class="text-decoration-underline">مدخلات العميل</h5>
                                                            <div *ngIf="phase?.data?.length !==0">
                                                              <h5>اولا : البيانات</h5>
                                                              <ng-container *ngFor="let data of phase?.data">
                                                                <div class="row mt-2">
                                                                  <p class="col-md-3">{{data.name}} : </p>
                                                                  <span *ngIf="data.value" class="col-md-3"> {{data.value}}</span>
                                                                  <span *ngIf="!data.value" class="col-md-3"> لم يتم ادخالها من العميل </span>
                                                                </div>
                                                              </ng-container>
                                                            </div>
                                                            <div *ngIf="phase?.inputsNames?.length !=0" class="mt-2">
                                                              <h5>ثانيا : الملفات</h5>
                                                              <p>الملفات المطلوبة :
                                                                <span  *ngFor="let fileName of phase?.inputsNames">{{fileName.name}} / </span>
                                                              </p>

                                                              <div class="files">
                                                                <div class="upload-files">
                                                                   <p *ngIf="phase?.inputs?.length == 0">لم يتم ادخال الملفات</p>
                                                                      <ng-container *ngFor="let doc of phase.inputs">

                                                                        <lightgallery [settings]="settings" [onInit]="onInit">
                                                                          <a *ngFor="let item of doc.projectPhaseDocumentLists" [attr.data-lg-size]="100" className="gallery-item"
                                                                            [attr.href]="imgUrl+item.url" [attr.title]="fileType(item.name)==='pdf'?'قم بتحميل ملف من زر التحميل بالاعلي':''">
                                                                            <img className="img-responsive " class="img-thumbnails" src="{{imgUrl+item.url}}" *ngIf="fileType(item.name) === 'jpg'||'png'||'jpeg'" />
                                                                            <img className="img-responsive " class="img-thumbnails" src="/assets/icons/pdf.jpg" *ngIf="fileType(item.name) === 'pdf'" />
                                                                          </a>
                                                                        </lightgallery>
                                                                      </ng-container>
                                                                </div>
                                                              </div>
                                                            </div>

                                                          </div>
                                                        </div>
                                                        <div class="col-lg-12 mb-3">
                                                            <div class="txt">
                                                                <div class="files">
                                                                  <h5 class="text-decoration-underline"> مخرجات المرحلة</h5>
                                                                  <p class="col-md-3">الملفات المطلوبة :
                                                                    <span  *ngFor="let fileName of phase?.outputsNames">{{fileName.name}} / </span>
                                                                  </p>
                                                                  <div class="upload-files">
                                                                        <div class="add-file-btn" *ngIf="userType == 2 && phase?.isCurrant">
                                                                            <button>
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                                                                                    <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                                                                                </svg>
                                                                                <input id="file" #file type="file" class="form-control" multiple=""
                                                                                (change)="uploadFile(file.files)"  accept=".pdf,.jpg,.png,.jpeg">
                                                                            </button>
                                                                        </div>
                                                                        <div class="img-ulpoad add-file-btn" *ngIf="userType == 2 && phase?.isCurrant">
                                                                            <div class="form-group d-flex" *ngIf="images">
                                                                                <div *ngFor='let url of images;let i=index' class="position-relative">
                                                                                    <img [src]="url">
                                                                                    <div class="delete-btn">
                                                                                        <button (click)="deleteImg(i)">
                                                                                            <img src="/assets/icons/delete-icon.png" alt="" srcset="">
                                                                                        </button>
                                                                                    </div>
                                                                                </div>

                                                                            </div>
                                                                      </div>
                                                                      <p *ngIf="phase.outputs?.length == 0 && images.length == 0">لا توجد مرفقات للمشروع</p>
                                                                      <ng-container *ngFor="let doc of phase.outputs">

                                                                        <lightgallery [settings]="settings" [onInit]="onInit">
                                                                          <a *ngFor="let item of doc.projectPhaseDocumentLists" [attr.data-lg-size]="100" className="gallery-item"
                                                                           [attr.href]="imgUrl+item.url" [attr.title]="fileType(item.name)==='pdf'?'قم بتحميل ملف من زر التحميل بالاعلي':''">
                                                                            <img className="img-responsive " class="img-thumbnails" src="{{imgUrl+item.url}}" *ngIf="fileType(item.name) === 'jpg'||'jpeg' ||'png'" />
                                                                            <img className="img-responsive " class="img-thumbnails" src="/assets/icons/pdf.jpg" *ngIf="fileType(item.name) === 'pdf'" />
                                                                          </a>
                                                                        </lightgallery>
                                                                      </ng-container>

                                                                    </div>
                                                                    <span *ngIf="userType == 2 && phase?.isCurrant">* يمكنك رفع ملفات و مرفقات المشروع بصيغ pdf, jpg , jpeg , png</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button class="add-stage" *ngIf="userType == 2 && phase?.isCurrant"  (click)="updatePhase(phase.id,2);updateProjectDone(updateProjectPhaseDone)">

                                                      تحديث
                                                  </button>
                                                  <!-- Add Invoice -->
                                                  <nz-modal [(nzVisible)]="isVisible2" nzTitle="إضافة فاتورة">
                                                    <ng-container *nzModalContent>
                                                        <div class="mb-4 row">
                                                            <label for="staticEmail" class="col-sm-3 col-form-label">المراحل المتضمنة</label>
                                                            <div class="col-sm-9">
                                                                <div>
                                                                  <!-- <nz-select nzMode="tags" nzPlaceHolder="Tag Mode" [(ngModel)]="phasesSelect">
                                                                      <nz-option style="z-index:9999" *ngFor="let phaseDo of AllphasesDone" [nzLabel]="phaseDo.phase.title" [nzValue]="phaseDo.phase.id"></nz-option>
                                                                    </nz-select> -->
                                                                    <nz-select
                                                                    [nzMaxTagCount]="3"
                                                                    [nzMaxTagPlaceholder]="tagPlaceHolder"
                                                                    nzMode="multiple"
                                                                    nzPlaceHolder="Please select"
                                                                    [(ngModel)]="phasesSelect"
                                                                  >
                                                                    <nz-option *ngFor="let item of AllphasesDone" [nzLabel]="item.title" [nzValue]="item.id"></nz-option>
                                                                  </nz-select>
                                                                  <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-4 row">
                                                            <label for="price" class="col-sm-3 col-form-label">القيمة المطلوبة</label>
                                                            <div class="col-sm-9">
                                                                <input type="number" class="form-control" id="price" placeholder="" [(ngModel)]="price">
                                                            </div>
                                                        </div>
                                                        <div class="mb-4 row">
                                                            <label for="date" class="col-sm-3 col-form-label">تاريخ الاستحقاق</label>
                                                            <div class="col-sm-9">
                                                                <input type="date" class="form-control" id="date" name='date' [(ngModel)]="date">
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                    <div *nzModalFooter>
                                                        <button nz-button nzType="default" (click)="handleCancel2()">إلغاء</button>
                                                        <button nz-button nzType="primary"  (click)="createInvoice()">حفظ</button>
                                                      </div>
                                                  </nz-modal>
                                                <div class="modal fade add-invoice-modal" id="addInvoiceModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                  <div class="modal-dialog modal-dialog-centered modal-lg">
                                                      <div class="modal-content">
                                                          <div class="modal-header">
                                                              <h5 class="modal-title" id="exampleModalLabel">إضافة فاتورة</h5>
                                                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                                                                      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                                                  </svg>
                                                              </button>
                                                          </div>
                                                          <div class="modal-body">

                                                              <div class="mb-4 row">
                                                                  <label for="staticEmail" class="col-sm-3 col-form-label">المراحل المتضمنة</label>
                                                                  <div class="col-sm-9">
                                                                      <div>
                                                                        <!-- <nz-select nzMode="tags" nzPlaceHolder="Tag Mode" [(ngModel)]="phasesSelect">
                                                                            <nz-option style="z-index:9999" *ngFor="let phaseDo of AllphasesDone" [nzLabel]="phaseDo.phase.title" [nzValue]="phaseDo.phase.id"></nz-option>
                                                                          </nz-select> -->
                                                                          <nz-select
                                                                          [nzMaxTagCount]="3"
                                                                          [nzMaxTagPlaceholder]="tagPlaceHolder"
                                                                          nzMode="multiple"
                                                                          nzPlaceHolder="Please select"
                                                                          [(ngModel)]="phasesSelect"
                                                                        >
                                                                          <nz-option *ngFor="let item of AllphasesDone" [nzLabel]="item.title" [nzValue]="item.id"></nz-option>
                                                                        </nz-select>
                                                                        <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>

                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="price" class="col-sm-3 col-form-label">القيمة المطلوبة</label>
                                                                  <div class="col-sm-9">
                                                                      <input type="number" class="form-control" id="price" placeholder="" [(ngModel)]="price">
                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="date" class="col-sm-3 col-form-label">تاريخ الاستحقاق</label>
                                                                  <div class="col-sm-9">
                                                                      <input type="date" class="form-control" id="date" name='date' [(ngModel)]="date">
                                                                  </div>
                                                              </div>
                                                          </div>
                                                          <div class="modal-footer">
                                                              <button type="button" class="btn btn-primary" (click)="createInvoice()">إضافة</button>
                                                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">الغاء</button>
                                                          </div>
                                                      </div>
                                                  </div>
                                              </div>
                                                </div>
                                            </div>
                                            </ng-container>
                                            <!-- <button *ngIf="userType == 0" type="button" class="btn btn-primary mx-2" data-bs-toggle="modal" data-bs-target="#addProjectStageModal">
                                              إضافة مرحلة مشروع
                                            </button> -->
                                            <!-- Add Phases -->
                                            <button nz-button *ngIf="userType == 0 && Project.totalWight < 100" [nzType]="'primary'"  (click)="showModal()"><span> إضافة مرحلة مشروع</span></button>
                                            <nz-modal [(nzVisible)]="isVisible" nzTitle=">إضافة مرحلة مشروع">
                                                <ng-container *nzModalContent>
                                                    <div class="mb-4 row">
                                                        <label for="staticEmail" class="col-sm-3 col-form-label">نوع الخدمة</label>
                                                        <div class="col-sm-9">
                                                            <select id="inputState" class="form-select" [(ngModel)]="newService.id"
                                                                (change)="selectServices($any($event).target)" name="service">
                                                                <option value="0" >أختر الخدمة</option>
                                                                <option *ngFor="let s of services;let i = index" [value]="s.id">{{s.name}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="mb-4 row">
                                                      <label for="staticEmail" class="col-sm-3 col-form-label"></label>
                                                      <div class="col-sm-9">
                                                          <button class="add-stage primary"  (click)="addPhase2() ">
                                                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                                  fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                                                                  <path
                                                                      d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                                                  <path
                                                                      d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                                              </svg>
                                                              إضافة مرحلة
                                                          </button>

                                                          <div class="mt-2"  *ngIf="addPhaseBtn" >
                                                              <div class="mb-4 row">
                                                                  <label for="staticEmail" class="col-sm-3 col-form-label">مراحل الخدمة</label>
                                                                  <div class="col-sm-9">
                                                                      <div class="row">
                                                                          <div class="col-lg-12 mb-2">
                                                                              <select id="inputState" class="form-select"
                                                                                  [(ngModel)]="newPhase.phaseId"
                                                                                  (change)="selectPhase($any($event).target)" name="phase">
                                                                                  <option value="0" selected>أختر المرحلة</option>
                                                                                  <option *ngFor="let p of allPhases;let i = index" [value]="p.id">
                                                                                      {{p.title}}
                                                                                  </option>
                                                                              </select>
                                                                          </div>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="staticEmail" class="col-sm-3 col-form-label">اسم المقاول</label>
                                                                  <div class="col-sm-9">
                                                                      <select id="inputState" class="form-select" [(ngModel)]="newPhase.userId"
                                                                        name="region">
                                                                          <option *ngFor="let c of constructors;let i = index" [value]="c.id">
                                                                              {{c.name}}</option>
                                                                      </select>
                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="staticEmail" class="col-sm-3 col-form-label">مدة التنفيذ</label>
                                                                  <div class="col-sm-5 mb-2">
                                                                      <input type="number" class="form-control mb-2" id="timeToComplete"
                                                                          placeholder="" [(ngModel)]="newPhase.implementPeriod" name="projectPeriod"
                                                                          #projectPeriod="ngModel">
                                                                      <span>زمن التنفيذ</span>
                                                                  </div>
                                                                  <div class="col-sm-4">
                                                                      <select id="inputState" class="form-select mb-2"
                                                                          [(ngModel)]="newPhase.implementPeriodType">
                                                                          <option value="0">يوم</option>
                                                                          <option value="1">شهر</option>
                                                                          <option value="2">سنة</option>
                                                                      </select>
                                                                      <span>المعدل الزمني</span>

                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="startDate" class="col-sm-3 col-form-label">تاريخ البدء</label>
                                                                  <div class="col-sm-9">
                                                                      <div class="row">
                                                                          <div class="col-lg-12 mb-2">
                                                                              <input type="date" class="form-control mb-2" id="startDate"
                                                                                  placeholder="" [(ngModel)]="newPhase.dateStart" name="dateStart"
                                                                                  #dateStart="ngModel">
                                                                          </div>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                <label for="startDate" class="col-sm-3 col-form-label">وزن المرحلة</label>
                                                                <div class="col-sm-9">
                                                                    <div class="row">
                                                                        <div class="col-lg-12 mb-2">
                                                                            <input type="number" min="0" max="100" class="form-control mb-2" id="doneWight"
                                                                                placeholder="" [(ngModel)]="newPhase.doneWight" name="doneWight"
                                                                                #dateStart="ngModel">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                              <!-- <div class="modal-footer">
                                                                <button type="button" class="btn btn-primary" (click)="addNewPhase(newPhase,newService)">حفظ</button>
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">الغاء</button>
                                                                </div> -->

                                                          </div>

                                                      </div>
                                                    </div>
                                                </ng-container>
                                                <div *nzModalFooter>
                                                    <button nz-button nzType="default" (click)="handleCancel()">إلغاء </button>
                                                    <button nz-button nzType="primary" (click)="addNewPhase()">حفظ</button>
                                                  </div>
                                            </nz-modal>

                                          <!-- <div class="modal fade add-project-stage-modal" id="addProjectStageModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered modal-lg">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLabel">إضافة مرحلة مشروع</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                                                                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                      <div class="mb-4 row">
                                                        <label for="staticEmail" class="col-sm-3 col-form-label">نوع الخدمة</label>
                                                        <div class="col-sm-9">
                                                            <select id="inputState" class="form-select" [(ngModel)]="newService.id"
                                                                (change)="selectServices($any($event).target)" name="service">
                                                                <option *ngFor="let s of services;let i = index" [value]="s.id">{{s.name}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="mb-4 row">
                                                      <label for="staticEmail" class="col-sm-3 col-form-label"></label>
                                                      <div class="col-sm-9">
                                                          <button class="add-stage"  (click)="addPhase2() ">
                                                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                                  fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                                                                  <path
                                                                      d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                                                  <path
                                                                      d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                                              </svg>
                                                              إضافة مرحلة
                                                          </button>

                                                          <div class="mt-2"  *ngIf="addPhaseBtn" >
                                                              <div class="mb-4 row">
                                                                  <label for="staticEmail" class="col-sm-3 col-form-label">مراحل الخدمة</label>
                                                                  <div class="col-sm-9">
                                                                      <div class="row">
                                                                          <div class="col-lg-12 mb-2">
                                                                              <select id="inputState" class="form-select"
                                                                                  [(ngModel)]="newPhase.phaseId"
                                                                                  (change)="selectPhase($any($event).target)" name="phase">
                                                                                  <option *ngFor="let p of allPhases;let i = index" [value]="p.id">
                                                                                      {{p.title}}
                                                                                  </option>
                                                                              </select>
                                                                          </div>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="staticEmail" class="col-sm-3 col-form-label">اسم المقاول</label>
                                                                  <div class="col-sm-9">
                                                                      <select id="inputState" class="form-select" [(ngModel)]="newPhase.userId"
                                                                        name="region">
                                                                          <option *ngFor="let c of constructors;let i = index" [value]="c.id">
                                                                              {{c.name}}</option>
                                                                      </select>
                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="staticEmail" class="col-sm-3 col-form-label">مدة التنفيذ</label>
                                                                  <div class="col-sm-5 mb-2">
                                                                      <input type="number" class="form-control mb-2" id="timeToComplete"
                                                                          placeholder="" [(ngModel)]="newPhase.implementPeriod" name="projectPeriod"
                                                                          #projectPeriod="ngModel">
                                                                      <span>زمن التنفيذ</span>
                                                                  </div>
                                                                  <div class="col-sm-4">
                                                                      <select id="inputState" class="form-select mb-2"
                                                                          [(ngModel)]="newPhase.implementPeriodType">
                                                                          <option selected value="1">يوم</option>
                                                                          <option value="30">شهر</option>
                                                                          <option value="365">سنة</option>
                                                                      </select>
                                                                      <span>المعدل الزمني</span>

                                                                  </div>
                                                              </div>
                                                              <div class="mb-4 row">
                                                                  <label for="startDate" class="col-sm-3 col-form-label">تاريخ البدء</label>
                                                                  <div class="col-sm-9">
                                                                      <div class="row">
                                                                          <div class="col-lg-12 mb-2">
                                                                              <input type="date" class="form-control mb-2" id="startDate"
                                                                                  placeholder="" [(ngModel)]="newPhase.dateStart" name="dateStart"
                                                                                  #dateStart="ngModel">
                                                                          </div>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div class="modal-footer">
                                                                <button type="button" class="btn btn-primary" (click)="addNewPhase(newPhase,newService)">حفظ</button>
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">الغاء</button>
                                                            </div>

                                                          </div>

                                                      </div>
                                                  </div>
                                                    </div>
                                                  </div>
                                            </div>
                                          </div> -->
                                        </article>
                                    </div>
                                </div>
                                <!-- ملاحظات -->
                                <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                                    <div class="notes-tab">
                                        <header>
                                            <h4>{{Project.name}} </h4>
                                            <button (click)="back()">
                                                <span class="mx-2">عودة</span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                                                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                                                </svg>
                                            </button>
                                        </header>
                                        <article>
                                            <div class="chat-section">
                                                <div *ngIf="allNotes.length == 0">
                                                    <p>لا توجد ملاحظات لهذا المشروع </p>
                                                </div>
                                                <ng-container *ngIf="allNotes.length !== 0">
                                                    <ng-container *ngFor="let note of allNotes">
                                                        <div class="sender-message" *ngIf="userId == note.userId">
                                                            <div class="message-content">
                                                              <img src="/assets/notes/admin.jpeg" alt="admin" srcset="" *ngIf="note.userTypeId === 0">
                                                              <img src="/assets/notes/customer.jpeg" alt="customer" srcset=""  *ngIf="note.userTypeId === 1">
                                                              <img src="/assets/notes/constructor.jpeg" alt="constructor" srcset="" *ngIf="note.userTypeId === 2">
                                                              <span class="mx-3">{{note.noteBody}}</span>
                                                            </div>
                                                            <time>{{note.creationTime|date:'dd/MM hh:mm'}}</time>
                                                        </div>
                                                        <div class="reciever-message" *ngIf="userId !== note.userId">
                                                            <time>{{note.creationTime|date:'dd/MM hh:mm'}}</time>
                                                            <div class="message-content">
                                                                <span class="mx-3">{{note.noteBody}}</span>
                                                                <img src="/assets/notes/admin.jpeg" alt="admin" srcset="" *ngIf="note.userTypeId === 0">
                                                                <img src="/assets/notes/customer.jpeg" alt="customer" srcset=""  *ngIf="note.userTypeId === 1">
                                                                <img src="/assets/notes/constructor.jpeg" alt="constructor" srcset="" *ngIf="note.userTypeId === 2">
                                                                </div>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>


                                                <div class="chat-action border-top pt-4">
                                                    <div class="row">
                                                        <div class="col-lg-4 order-2 order-lg-1 my-2">
                                                            <div class="btns">
                                                                <button class="send" [disabled]="currentPhaseId == 0" (click)="sendChat()">
                                                                    <img src="/assets/icons/send.png" alt="" srcset="">
                                                                    <span>ارسال</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-8  order-1 order-lg-2 my-2">
                                                            <div class="text">
                                                                <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" [(ngModel)]="chatNotes" name="chatNotes"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </article>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="!isLoaded" class="form-content h-100 d-flex justify-content-center">
                          <img width="128" height="128" src="/assets/icons/loading.gif" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</section>
